{% extends "base.html" %}
{% block title %}LogSentry Login{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-5">
        <div class="card shadow-lg border-0 rounded-lg mt-5">
            <div class="card-header bg-dark text-white">
                <h3 class="text-center font-weight-light my-4">
                    <i class="bi bi-shield-lock me-2"></i>LogSentry Login
                </h3>
            </div>
            <div class="card-body">
                
                <form id="login-form">
                    <div class="form-floating mb-3">
                        <input type="email" class="form-control" id="email" placeholder="name@example.com" required>
                        <label for="email">Email address</label>
                    </div>
                    
                    <div class="form-floating mb-3">
                        <input type="password" class="form-control" id="password" placeholder="Password" required>
                        <label for="password">Password</label>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg" id="login-button">
                            <span class="spinner-border spinner-border-sm" id="login-spinner" style="display: none;" role="status" aria-hidden="true"></span>
                            Login
                        </button>
                    </div>
                </form>

                <div class="text-center mt-3">
                    <small>Don't have an account? <a href="{{ url_for('register') }}">Register here</a></small>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
    {{ super() }} <script>
        const loginForm = document.getElementById('login-form');
        const spinner = document.getElementById('login-spinner');
        const loginButton = document.getElementById('login-button');
        
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault(); // Stop the form from submitting
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            spinner.style.display = 'inline-block';
            loginButton.disabled = true;

            // Use Firebase to sign in
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Signed in 
                    spinner.style.display = 'none';
                    // Show success
                    showAlert('Logged in successfully! Redirecting...', 'success', false);
                    // Redirect to the dashboard after a short delay
                    setTimeout(() => {
                        window.location.href = '/dashboard';
                    }, 1500);
                })
                .catch((error) => {
                    spinner.style.display = 'none';
                    loginButton.disabled = false;
                    console.error('Login Error:', error.code, error.message);
                    // Show a user-friendly error
                    showAlert(`Login Failed: ${error.message}`, 'danger');
                });
        });
    </script>
{% endblock %}